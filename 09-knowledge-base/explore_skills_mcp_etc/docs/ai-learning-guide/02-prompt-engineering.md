# 模块二：Prompt Engineering（提示词工程）

> 学会如何与 AI 有效沟通

---

## 第5章：Prompt 基础概念

### 5.1 什么是 Prompt

**Prompt（提示词）** 是你给 AI 的输入，用于引导它生成你想要的输出。

```
简单理解：
Prompt = 你对 AI 说的话 + 你提供的背景信息 + 你期望的输出要求
```

**Prompt 的重要性：**

```
同样的 LLM，不同的 Prompt，结果天差地别：

❌ 糟糕的 Prompt：
"写点代码"
→ AI：不知道写什么，可能随便输出一段代码

✅ 好的 Prompt：
"用 Python 写一个函数，接收一个列表，返回其中的偶数，
 要求：使用列表推导式，添加类型注解，包含 docstring"
→ AI：输出符合要求的高质量代码
```

### 5.2 System Prompt vs User Prompt

```
┌─────────────────────────────────────────────────────────┐
│                    Prompt 的两种类型                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  System Prompt（系统提示词）                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │ • 设定 AI 的角色、行为准则                       │   │
│  │ • 定义输出格式、语言风格                         │   │
│  │ • 通常由开发者/应用设置                          │   │
│  │ • 用户一般看不到                                 │   │
│  │ • 优先级较高                                     │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  User Prompt（用户提示词）                              │
│  ┌─────────────────────────────────────────────────┐   │
│  │ • 具体的问题或任务                               │   │
│  │ • 用户直接输入的内容                             │   │
│  │ • 可以包含上下文、示例                           │   │
│  │ • 每次对话都可能不同                             │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**示例对比：**

```
System Prompt 示例：
"你是一个专业的代码审查员。你的任务是审查用户提供的代码，
 指出潜在的问题、安全隐患和改进建议。使用友好但专业的语气。
 始终用中文回复。"

User Prompt 示例：
"请审查这段代码：
 def login(username, password):
     query = f'SELECT * FROM users WHERE name={username}'
     ..."
```

### 5.3 Prompt 与模型输出的关系

```
Prompt 的质量直接决定输出的质量：

┌──────────────┐      ┌───────────┐      ┌──────────────┐
│   Prompt     │ ───▶ │    LLM    │ ───▶ │    输出      │
│  （输入）    │      │  （处理） │      │  （结果）    │
└──────────────┘      └───────────┘      └──────────────┘
       │                                        │
       │         Garbage In, Garbage Out        │
       └────────────────────────────────────────┘
                   垃圾进，垃圾出

影响输出的因素：
• Prompt 的清晰度 → 输出的准确度
• Prompt 的详细程度 → 输出的完整度
• Prompt 的结构 → 输出的格式
• Prompt 的示例 → 输出的风格
```

### 5.4 类比理解

> **Prompt 是"给 AI 的工作说明书"**

```
想象你在给一个新员工布置任务：

❌ 模糊的指令：
"把那个报告弄一下"
→ 员工：？？？哪个报告？怎么弄？

✅ 清晰的指令：
"请把上个月的销售报告更新一下：
 1. 添加本周的数据
 2. 重新计算环比增长率
 3. 用图表展示趋势
 4. 周五下班前发给我"
→ 员工：明白了！

AI 也是一样——你的指令越清晰，结果越好。
```

---

## 第6章：有效 Prompt 的设计原则

### 6.1 清晰明确原则

```
原则：避免歧义，直接说明你要什么

❌ 模糊：
"帮我处理一下这个文件"

✅ 清晰：
"请将这个 CSV 文件中的日期格式从 MM/DD/YYYY 转换为 YYYY-MM-DD"

❌ 模糊：
"写个好点的函数"

✅ 清晰：
"重构这个函数：
 - 将重复代码提取为辅助函数
 - 添加异常处理
 - 优化时间复杂度从 O(n²) 到 O(n)"
```

### 6.2 提供上下文

```
原则：给 AI 足够的背景信息

❌ 缺少上下文：
"这个 bug 怎么修？"

✅ 提供上下文：
"我在开发一个 React 应用，使用 TypeScript。
 当用户点击提交按钮时，控制台报错：
 'TypeError: Cannot read property 'map' of undefined'
 
 相关代码如下：
 [代码]
 
 预期行为是：显示用户列表
 实际行为是：页面崩溃
 
 请帮我分析原因并提供修复方案。"
```

**上下文的类型：**

```
┌─────────────────────────────────────────────────────┐
│ 上下文类型        │ 示例                           │
├─────────────────────────────────────────────────────┤
│ 技术背景          │ "使用 Python 3.11，Django 4.2" │
│ 业务背景          │ "这是一个电商网站的购物车功能"  │
│ 问题背景          │ "之前尝试过 X 方法，没有效果"   │
│ 约束条件          │ "需要兼容 IE11"                │
│ 目标受众          │ "写给非技术人员看的"           │
│ 期望结果          │ "需要可以直接运行的代码"        │
└─────────────────────────────────────────────────────┘
```

### 6.3 指定输出格式

```
原则：明确告诉 AI 你想要什么格式的输出

❌ 不指定格式：
"列出 Python 的数据类型"

✅ 指定格式：
"列出 Python 的基本数据类型，使用以下格式：
 | 类型 | 说明 | 示例 |
 |------|------|------|
 "

常用格式指定：
• "用 Markdown 格式输出"
• "返回 JSON 格式，包含以下字段：..."
• "分点列出，每点不超过 50 字"
• "用表格形式展示"
• "按照 问题-原因-解决方案 的结构回答"
```

### 6.4 分步骤引导

```
原则：复杂任务拆分成步骤

❌ 一步到位（容易出错）：
"分析这份数据并给出商业建议"

✅ 分步骤：
"请按以下步骤分析这份销售数据：

 第一步：数据概览
 - 总记录数、时间范围、数据完整性

 第二步：关键指标分析
 - 总销售额、平均客单价、销售趋势

 第三步：发现与洞察
 - 异常值、季节性规律、相关性

 第四步：商业建议
 - 基于以上分析给出 3 条可执行的建议"
```

### 6.5 给出示例（Few-shot Learning）

```
原则：用示例展示你期望的输出

❌ 无示例：
"把这些句子翻译成正式的商务英语"

✅ 有示例：
"把这些句子翻译成正式的商务英语。

 示例：
 输入：这个价格太贵了
 输出：We find the proposed pricing to be above our budget expectations.

 输入：明天能交货吗？
 输出：Would it be feasible to arrange delivery by tomorrow?

 现在翻译以下句子：
 1. 我们对这个方案不太满意
 2. 能便宜点吗？"
```

---

## 第7章：常用 Prompt 技巧

### 7.1 角色扮演法（Role Playing）

```
技巧：让 AI 扮演特定角色，获得专业视角

模式：
"你是一个 [角色]，具有 [特定能力/经验]。
 请从这个角色的视角来 [完成任务]。"

示例：

角色：资深代码审查员
"你是一个有 10 年经验的高级软件工程师，专注于代码质量和安全。
 请审查以下代码，关注：
 - 安全漏洞
 - 性能问题
 - 可维护性
 - 最佳实践"

角色：产品经理
"你是一个经验丰富的产品经理。
 请从用户体验的角度评估这个功能设计，
 考虑：用户痛点、使用场景、边界情况。"

角色：初学者导师
"你是一个耐心的编程导师，正在教一个完全的初学者。
 请用最简单的语言解释什么是递归，
 避免使用任何专业术语。"
```

### 7.2 思维链（Chain of Thought）

```
技巧：让 AI 展示推理过程，提高准确性

模式：
"请一步一步思考，展示你的推理过程。"
"Let's think step by step."

为什么有效？
┌─────────────────────────────────────────────────┐
│ 直接回答 vs 思维链                              │
├─────────────────────────────────────────────────┤
│ 问题：鸡兔同笼，共 10 头 28 脚，各多少？        │
│                                                 │
│ 直接回答（可能出错）：                           │
│ "鸡 6 只，兔 4 只"  ← 可能是猜的                │
│                                                 │
│ 思维链（更可靠）：                               │
│ "让我一步步计算：                               │
│  1. 设鸡 x 只，兔 y 只                          │
│  2. 头：x + y = 10                              │
│  3. 脚：2x + 4y = 28                            │
│  4. 从第一个方程：x = 10 - y                    │
│  5. 代入第二个：2(10-y) + 4y = 28              │
│  6. 解得：20 - 2y + 4y = 28 → 2y = 8 → y = 4  │
│  7. 所以 x = 6                                  │
│  答案：鸡 6 只，兔 4 只"                        │
└─────────────────────────────────────────────────┘
```

### 7.3 自我一致性（Self-Consistency）

```
技巧：让 AI 多次回答，然后选择一致的答案

模式：
"请用三种不同的方法解决这个问题，
 然后比较结果，给出你最有信心的答案。"

应用场景：
• 数学计算
• 逻辑推理
• 复杂决策

示例：
"请分析这段代码是否有 bug：
 1. 首先，逐行阅读，找出可能的问题
 2. 然后，假设输入边界值，追踪执行流程
 3. 最后，与已知的最佳实践对比
 
 综合以上分析，给出你的结论。"
```

### 7.4 零样本 vs 少样本学习

```
┌─────────────────────────────────────────────────────────┐
│ Zero-shot（零样本）                                     │
│ ─────────────────────                                   │
│ 不提供示例，直接让 AI 完成任务                          │
│                                                         │
│ 示例：                                                  │
│ "将以下文本分类为正面、负面或中性：                     │
│  '这个产品还行，没什么特别的'"                          │
│                                                         │
│ 适用：简单任务、AI 已经"知道"怎么做的任务              │
├─────────────────────────────────────────────────────────┤
│ Few-shot（少样本）                                      │
│ ─────────────────                                       │
│ 提供几个示例，让 AI 学习模式                            │
│                                                         │
│ 示例：                                                  │
│ "将以下文本分类：                                       │
│                                                         │
│  示例 1：'太棒了，超出预期！' → 正面                   │
│  示例 2：'质量很差，很失望' → 负面                     │
│  示例 3：'还可以，中规中矩' → 中性                     │
│                                                         │
│  现在分类：'这个产品还行，没什么特别的'"               │
│                                                         │
│ 适用：复杂任务、需要特定格式、自定义分类标准            │
└─────────────────────────────────────────────────────────┘
```

### 7.5 结构化输出技巧

```
技巧：使用结构化格式确保输出可控

方法 1：Markdown 格式
"请用以下 Markdown 结构回答：
 ## 问题分析
 ## 可能的原因
 ## 推荐解决方案
 ## 注意事项"

方法 2：JSON 格式
"请以 JSON 格式输出，结构如下：
 {
   'summary': '简要总结',
   'pros': ['优点1', '优点2'],
   'cons': ['缺点1', '缺点2'],
   'recommendation': '建议'
 }"

方法 3：模板填空
"请按以下模板回答：
 【功能名称】：___
 【主要用途】：___
 【使用示例】：___
 【注意事项】：___"
```

---

## 第8章：实战案例与练习

### 8.1 代码生成 Prompt 设计

```
最佳实践结构：

[角色设定]（可选）
[任务描述]
[技术要求]
[输入输出规范]
[约束条件]
[示例]（可选）
```

**示例：**

```
你是一个 Python 后端开发专家。

任务：编写一个用户认证函数

技术要求：
- 使用 Python 3.10+
- 使用 bcrypt 进行密码哈希
- 包含类型注解
- 添加详细的 docstring

函数签名：
def authenticate_user(username: str, password: str) -> dict | None

要求：
1. 从数据库查询用户（假设有 get_user_by_username 函数）
2. 验证密码
3. 成功返回用户信息（不含密码），失败返回 None
4. 处理可能的异常

请只返回代码，不需要解释。
```

### 8.2 文档总结 Prompt 设计

```
示例 Prompt：

请总结以下文档的核心内容。

要求：
1. 总字数控制在 200 字以内
2. 分为以下几个部分：
   - 主题：一句话概括
   - 要点：3-5 个核心观点
   - 结论：作者的主要结论
3. 使用简洁、专业的语言
4. 保持客观，不添加个人评论

文档内容：
[粘贴文档]
```

### 8.3 数据分析 Prompt 设计

```
示例 Prompt：

你是一个数据分析师，请分析以下销售数据。

数据说明：
- 时间范围：2024年1月-12月
- 字段：日期、产品类别、销售额、销售量、地区

分析要求：
1. 描述性统计
   - 总销售额、平均月销售额
   - 各类别占比

2. 趋势分析
   - 月度销售趋势
   - 季节性规律

3. 对比分析
   - 各地区表现
   - 产品类别表现

4. 洞察与建议
   - 关键发现（至少 3 点）
   - 可执行建议（至少 2 点）

输出格式：使用 Markdown，包含表格和要点列表。

数据：
[数据]
```

### 8.4 常见错误与优化建议

```
┌───────────────────────────────────────────────────────────┐
│ 常见错误                    │ 优化建议                    │
├───────────────────────────────────────────────────────────┤
│ ❌ 太模糊                   │ ✅ 具体化                   │
│ "写个好函数"                │ "写一个验证邮箱格式的函数"  │
├───────────────────────────────────────────────────────────┤
│ ❌ 信息过载                 │ ✅ 聚焦重点                 │
│ 一次问太多不相关的问题      │ 每次聚焦一个主题            │
├───────────────────────────────────────────────────────────┤
│ ❌ 缺少上下文               │ ✅ 提供背景                 │
│ "这段代码有什么问题？"      │ 说明环境、预期行为、实际行为│
├───────────────────────────────────────────────────────────┤
│ ❌ 期望不明确               │ ✅ 明确输出要求             │
│ "帮我改进这个"              │ "从性能角度优化，目标..."   │
├───────────────────────────────────────────────────────────┤
│ ❌ 没有迭代                 │ ✅ 多轮对话                 │
│ 一次就想得到完美结果        │ 根据输出继续调整和追问      │
└───────────────────────────────────────────────────────────┘
```

### 8.5 练习题

**练习 1：改进 Prompt**

```
原始 Prompt：
"写个排序函数"

你的任务：改进这个 Prompt，使其更清晰、更具体。
要求包含：语言、算法选择、输入输出、边界情况处理。

参考答案：
[自己先尝试，再看下面的参考]
.
.
.
参考改进：
"用 Python 实现一个快速排序函数。

 要求：
 - 函数签名：def quicksort(arr: list[int]) -> list[int]
 - 使用原地排序，不创建新数组
 - 处理空列表和单元素列表的边界情况
 - 添加 docstring 和类型注解
 - 时间复杂度要求：平均 O(n log n)"
```

**练习 2：编写 System Prompt**

```
场景：你要创建一个帮助用户学习英语的 AI 助手

任务：编写一个 System Prompt，定义：
- AI 的角色和性格
- 回答问题的方式
- 特殊行为规则

参考要点：
- 耐心、鼓励的语气
- 先用简单英语解释，再给中文翻译
- 指出常见错误，但不要过于严厉
- 提供记忆技巧
```

**练习 3：复杂任务拆解**

```
任务："帮我把这个 Express 后端重构成更好的架构"

问题：这个 Prompt 太模糊了

你的任务：
1. 列出需要澄清的问题（至少 5 个）
2. 编写一个分步骤的 Prompt

需要澄清的问题示例：
- 当前架构是什么样的？
- "更好"的具体标准是什么？
- 有哪些约束条件？
- ...
```

---

## 本章小结

```
核心要点回顾：

1. Prompt 基础
   ├── Prompt = 给 AI 的输入指令
   ├── System Prompt：设定角色和规则
   └── User Prompt：具体的任务和问题

2. 设计原则
   ├── 清晰明确：避免歧义
   ├── 提供上下文：背景信息充足
   ├── 指定格式：明确输出要求
   ├── 分步骤：复杂任务拆解
   └── 给示例：Few-shot Learning

3. 常用技巧
   ├── 角色扮演：获得专业视角
   ├── 思维链：展示推理过程
   ├── 自我一致性：多角度验证
   └── 结构化输出：可控的格式

4. 实战要点
   ├── 迭代优化：不满意就继续调整
   ├── 具体化：模糊的需求要细化
   └── 提供反馈：告诉 AI 哪里需要改进
```

---

**下一章 → [第9章：什么是 Agent](./03-ai-agents.md)**
